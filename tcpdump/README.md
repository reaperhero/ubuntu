# tcpdump


## 报文格式

packet 时间戳 | packet 类型 | 源 (SRC) IP 和端口，目的 (DST) IP 和端口 | flag | 序列号（seq） | 应答号（ack）| 包的 payload 长度 | 包的部分内容（ASCII）


## flags
```
S 表示 syn 包
. 表示 ack 包
F 表示 fin 包
P 表示 push 包（发送正常数据）
F : FIN - 结束; 结束会话
S : SYN - 同步; 表示开始会话请求
R : RST - 复位;中断一个连接
P : PUSH - 推送; 数据包立即发送
A : ACK - 应答
U : URG - 紧急
E : ECE - 显式拥塞提醒回应
W : CWR - 拥塞窗口减少
```


## 举例子
```
#1 22:33:49.446240 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [S], seq 3228202218, win 29200, options [mss 1460,sackOK,TS val 8989719 ecr 0,nop,wscale 7], length 0
#2 22:33:49.456062 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [S.], seq 2456664064, ack 3228202219, win 8192, options [mss 1452,sackOK,nop,nop,nop,nop,nop,nop,nop,nop,nop,nop,nop,wscale 5], length 0
#3 22:33:49.456088 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [.], ack 1, win 229, length 0

#4 22:33:49.456164 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [P.], seq 1:78, ack 1, win 229, length 77: HTTP: GET / HTTP/1.1
#5 22:33:49.466045 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [.], ack 78, win 908, length 0
#6 22:33:49.467216 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [P.], seq 1:1441, ack 78, win 908, length 1440: HTTP: HTTP/1.1 200 OK
#7 22:33:49.467235 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [.], ack 1441, win 251, length 0
#8 22:33:49.467241 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [P.], seq 1441:2782, ack 78, win 908, length 1341: HTTP
#9 22:33:49.467246 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [.], ack 2782, win 274, length 0

#10 22:33:49.467341 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [F.], seq 78, ack 2782, win 274, length 0
#11 22:33:49.477196 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [.], ack 79, win 908, length 0
#12 22:33:49.477321 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [F.], seq 2782, ack 79, win 908, length 0
#13 22:33:49.477336 IP 192.168.1.98.44576 > 180.101.49.11.http: Flags [.], ack 2783, win 274, length 0
#14 22:33:52.486142 IP 180.101.49.11.http > 192.168.1.98.44576: Flags [R], seq 2456666847, win 0, length 0
```

第一次握手: SYN
```
三次握手
#1: 发起一个 SYN 请求，请求建立连接，客户端初始序列号3228202218（客户端和服务端分别维护自己的序列号，两者没有关系，初始序列号是系统选择的，一般不是 0）,length 为 0，因为 SYN 包不带 TCP payload，所有信息都在 TCP header
#2: 序列号是3228202219为前面+1，这就说明，#2 是 #1 的应 答包，flags 为 S.，即 SYN+ACK,length 也是 0，说明没有 payload。seq为2456664064，这是服务端的初始序列号，与第一条消息时间差1ms
#3: ack为1，说明 #3 是 #2 的应答包，长度为 0，说明没有 TCP payload。到此三次握手完成

数据发送
#4: 客户端请求/，这个 packet 长度为 77 字节
#5: 180.101.49.11发送了 ACK 包，对 #4 进行确认
#6: 180.101.49.11发送了 1440 字节的数据给 client
#7: client 对 180.101.49.11 的 #6 进行应答
#8: 180.101.49.11继续发送了 1341 字节的数据给 client
#9: client 对 180.101.49.11 的 #8 进行应答

四次挥手
#10: client -> 180.101.49.11: FIN （我们看到的是 FIN+ACK，这是因为这个 FIN 包除了正常的关闭连接功能之外，还被用于应答 client 发过来的前一个包）
#11: 180.101.49.11 -> client: ACK
#12: 180.101.49.11 -->FIN + ACK
#13: client --> 180.101.49.11 ACK
#14: 服务器中断RST
```